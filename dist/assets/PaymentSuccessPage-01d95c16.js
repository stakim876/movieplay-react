import{n as I,h as i,S,o as d,R as g,g as j,a7 as f,a8 as E,u as K,d as R,y as k,r as l,j as e,k as A}from"./index-75deb616.js";/* empty css                       */async function C(r,s,a){throw new Error("운영 환경에서는 서버 사이드에서 결제를 검증해야 합니다.")}async function T(r,s){try{const a=I(i,"users",r,"subscription","current");await S(a,{status:"active",paymentMethod:{type:s.type||"card",last4:s.last4,brand:s.brand},updatedAt:d()}),await g(j(i,"users",r,"payments"),{amount:s.amount,currency:s.currency||"KRW",status:"succeeded",planId:s.planId,paymentDate:d(),billingPeriod:{start:f.fromDate(new Date),end:s.billingPeriodEnd?f.fromDate(s.billingPeriodEnd):null},transactionId:s.transactionId,receiptUrl:s.receiptUrl}),await g(j(i,"users",r,"subscriptionHistory"),{action:"subscribed",planId:s.planId,amount:s.amount,date:d()})}catch(a){throw console.error("구독 활성화 실패:",a),a}}function H(){const[r]=E(),s=K(),{user:a}=R(),{success:u,error:c}=k(),[v,P]=l.useState(!0),[n,N]=l.useState(null);return l.useEffect(()=>{(async()=>{var h,y,b,x;const o=r.get("orderId"),m=r.get("paymentKey"),p=r.get("amount");if(!o||!m||!p){c("결제 정보가 올바르지 않습니다."),s("/subscription");return}try{const t=await C(o,m,parseInt(p));N(t);const w=o.split("_")[2];a&&(await T(a.uid,{type:t.method||"card",last4:((y=(h=t.card)==null?void 0:h.number)==null?void 0:y.slice(-4))||"",brand:((b=t.card)==null?void 0:b.company)||"",amount:t.totalAmount,currency:"KRW",planId:w,transactionId:t.paymentKey,receiptUrl:((x=t.receipt)==null?void 0:x.url)||""}),u("구독이 활성화되었습니다!"))}catch(t){console.error("결제 처리 실패:",t),c(t.message||"결제 처리에 실패했습니다."),s("/subscription")}finally{P(!1)}})()},[r,a,s,u,c]),v?e.jsx("div",{className:"payment-result-page",children:e.jsx("div",{className:"payment-result-container",children:e.jsx("div",{className:"loading-spinner",children:"처리 중..."})})}):e.jsx("div",{className:"payment-result-page",children:e.jsx("div",{className:"payment-result-container",children:e.jsxs("div",{className:"payment-success",children:[e.jsx(A,{className:"success-icon"}),e.jsx("h1",{children:"결제가 완료되었습니다!"}),n&&e.jsxs("div",{className:"payment-details",children:[e.jsxs("p",{children:["주문 번호: ",n.orderId]}),e.jsxs("p",{children:["결제 금액: ",n.totalAmount.toLocaleString(),"원"]}),e.jsxs("p",{children:["결제 수단: ",n.method==="card"?"카드":n.method]})]}),e.jsxs("div",{className:"payment-actions",children:[e.jsx("button",{className:"btn-primary",onClick:()=>s("/subscription"),children:"구독 관리로 이동"}),e.jsx("button",{className:"btn-secondary",onClick:()=>s("/"),children:"홈으로 이동"})]})]})})})}export{H as default};
