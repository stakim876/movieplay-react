import{r,u as H,e as te,j as e,$ as W,a as X,a0 as se,a1 as re,a2 as ae,a3 as ne,a4 as le,a5 as ce,X as oe,C as ie,y as ue,E as K}from"./index-75deb616.js";import{a as de}from"./tmdb-dd13b212.js";import{D as z}from"./Skeleton-60dc65eb.js";/* empty css               */function me({movie:a,mediaType:h="movie",seasonNumber:p=null,episodeNumber:d=null,onClose:i,videoUrl:x=null}){const l=r.useRef(null),m=r.useRef(null),g=r.useRef(null),[c,b]=r.useState(!1),[k,F]=r.useState(0),[o,L]=r.useState(0),[j,u]=r.useState(1),[y,w]=r.useState(!1),[v,G]=r.useState(!1),[D,S]=r.useState(!0),[J,O]=r.useState(!0),[Q,Y]=r.useState(1),[$,V]=r.useState(!1);H();const{updateWatchProgress:M,getWatchProgress:B}=te(),E=r.useRef(null);r.useEffect(()=>{if(!a)return;const t=B(a.id,h,p,d);t&&t.progress>0&&l.current&&(l.current.currentTime=t.progress)},[a,h,p,d,B]),r.useEffect(()=>{const t=l.current;if(!t)return;const s=()=>{L(t.duration),O(!1)},n=()=>{F(t.currentTime),t.currentTime%5<.5&&a&&M(a.id,t.currentTime,t.duration,h,p,d)},f=()=>{b(!1),a&&M(a.id,o,o,h,p,d)},R=()=>b(!0),U=()=>b(!1);return t.addEventListener("loadedmetadata",s),t.addEventListener("timeupdate",n),t.addEventListener("ended",f),t.addEventListener("play",R),t.addEventListener("pause",U),()=>{t.removeEventListener("loadedmetadata",s),t.removeEventListener("timeupdate",n),t.removeEventListener("ended",f),t.removeEventListener("play",R),t.removeEventListener("pause",U)}},[a,h,p,d,o,M]),r.useEffect(()=>D?((()=>{E.current&&clearTimeout(E.current),S(!0),E.current=setTimeout(()=>{c&&S(!1)},3e3)})(),()=>{E.current&&clearTimeout(E.current)}):void 0,[D,c]);const N=r.useCallback(()=>{const t=l.current;t&&(c?t.pause():t.play())},[c]),Z=t=>{const s=l.current,n=g.current;if(!s||!n)return;const f=n.getBoundingClientRect(),R=(t.clientX-f.left)/f.width;s.currentTime=R*o},T=t=>{const s=l.current;if(!s)return;const n=parseFloat(t.target.value);u(n),s.volume=n,w(n===0)},I=()=>{const t=l.current;t&&(y?(t.volume=j||.5,w(!1)):(t.volume=0,w(!0)))},C=()=>{m.current&&(v?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():m.current.requestFullscreen?m.current.requestFullscreen():m.current.webkitRequestFullscreen?m.current.webkitRequestFullscreen():m.current.msRequestFullscreen&&m.current.msRequestFullscreen())};r.useEffect(()=>{const t=()=>{G(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",t),document.addEventListener("webkitfullscreenchange",t),document.addEventListener("msfullscreenchange",t),()=>{document.removeEventListener("fullscreenchange",t),document.removeEventListener("webkitfullscreenchange",t),document.removeEventListener("msfullscreenchange",t)}},[]);const P=t=>{const s=l.current;s&&(s.currentTime=Math.max(0,Math.min(o,s.currentTime+t)))},_=t=>{const s=l.current;s&&(s.playbackRate=t,Y(t),V(!1))};r.useEffect(()=>{const t=s=>{if(!(s.target.tagName==="INPUT"||s.target.tagName==="TEXTAREA"))switch(s.key){case" ":s.preventDefault(),N();break;case"ArrowLeft":s.preventDefault(),P(-10);break;case"ArrowRight":s.preventDefault(),P(10);break;case"ArrowUp":s.preventDefault();const n=Math.min(1,j+.1);T({target:{value:n}});break;case"ArrowDown":s.preventDefault();const f=Math.max(0,j-.1);T({target:{value:f}});break;case"f":case"F":s.preventDefault(),C();break;case"m":case"M":s.preventDefault(),I();break;case"Escape":v?C():i&&i();break}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[N,j,v,i]);const q=t=>{if(!t||isNaN(t))return"0:00";const s=Math.floor(t/3600),n=Math.floor(t%3600/60),f=Math.floor(t%60);return s>0?`${s}:${n.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`:`${n}:${f.toString().padStart(2,"0")}`},A=o>0?k/o*100:0,ee=x||"https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4";return a?e.jsxs("div",{className:"video-player-container",ref:m,onMouseMove:()=>S(!0),onMouseLeave:()=>{c&&setTimeout(()=>S(!1),2e3)},children:[J&&e.jsxs("div",{className:"video-player-loading",children:[e.jsx("div",{className:"player-spinner"}),e.jsx("p",{children:"로딩 중..."})]}),e.jsx("video",{ref:l,src:ee,className:"video-player",onClick:N,onDoubleClick:C}),D&&e.jsxs("div",{className:"video-player-controls",children:[e.jsxs("div",{className:"player-controls-top",children:[i&&e.jsx("button",{className:"player-close-btn",onClick:i,"aria-label":"닫기",children:"✕"}),e.jsxs("div",{className:"player-title",children:[e.jsx("h3",{children:a.title||a.name}),h==="tv"&&p!==null&&d!==null&&e.jsxs("span",{className:"player-episode",children:["시즌 ",p," · 에피소드 ",d]})]})]}),e.jsx("div",{className:"player-controls-center",children:e.jsx("button",{className:"player-play-btn-large",onClick:N,"aria-label":c?"일시정지":"재생",children:c?e.jsx(W,{}):e.jsx(X,{})})}),e.jsxs("div",{className:"player-controls-bottom",children:[e.jsx("div",{className:"player-progress-container",ref:g,onClick:Z,children:e.jsxs("div",{className:"player-progress-bar",children:[e.jsx("div",{className:"player-progress-fill",style:{width:`${A}%`}}),e.jsx("div",{className:"player-progress-handle",style:{left:`${A}%`}})]})}),e.jsxs("div",{className:"player-controls-row",children:[e.jsxs("div",{className:"player-controls-left",children:[e.jsx("button",{className:"player-control-btn",onClick:N,"aria-label":c?"일시정지":"재생",children:c?e.jsx(W,{}):e.jsx(X,{})}),e.jsx("button",{className:"player-control-btn",onClick:()=>P(-10),"aria-label":"10초 뒤로",children:e.jsx(se,{})}),e.jsx("button",{className:"player-control-btn",onClick:()=>P(10),"aria-label":"10초 앞으로",children:e.jsx(re,{})}),e.jsxs("div",{className:"player-volume-control",children:[e.jsx("button",{className:"player-control-btn",onClick:I,"aria-label":y?"음소거 해제":"음소거",children:y?e.jsx(ae,{}):e.jsx(ne,{})}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:y?0:j,onChange:T,className:"player-volume-slider"})]}),e.jsxs("div",{className:"player-time",children:[e.jsx("span",{children:q(k)}),e.jsx("span",{children:" / "}),e.jsx("span",{children:q(o)})]})]}),e.jsxs("div",{className:"player-controls-right",children:[e.jsxs("div",{className:"player-settings",children:[e.jsx("button",{className:"player-control-btn",onClick:()=>V(!$),"aria-label":"설정",children:"⚙️"}),$&&e.jsx("div",{className:"player-settings-menu",children:e.jsxs("div",{className:"settings-section",children:[e.jsx("span",{className:"settings-label",children:"재생 속도"}),[.5,.75,1,1.25,1.5,2].map(t=>e.jsxs("button",{className:`settings-option ${Q===t?"active":""}`,onClick:()=>_(t),children:[t,"x"]},t))]})})]}),e.jsx("button",{className:"player-control-btn",onClick:C,"aria-label":v?"전체화면 해제":"전체화면",children:v?e.jsx(le,{}):e.jsx(ce,{})})]})]})]})]})]}):e.jsx("div",{className:"video-player-container",children:e.jsxs("div",{className:"video-player-error",children:[e.jsx("p",{children:"콘텐츠 정보를 불러올 수 없습니다."}),i&&e.jsx("button",{onClick:i,className:"player-close-btn",children:"닫기"})]})})}function xe(){const{id:a}=oe(),h=ie(),p=H(),{error:d}=ue(),i=h.pathname.startsWith("/tv/")?"tv":"movie",x=new URLSearchParams(h.search),l=x.get("season")?parseInt(x.get("season")):null,m=x.get("episode")?parseInt(x.get("episode")):null,[g,c]=r.useState(null),[b,k]=r.useState(!0),[F,o]=r.useState(null);r.useEffect(()=>{(async()=>{k(!0),o(null);try{const u=await de(a,i),y=["porn","pornographic","xvideo","xhamster","zwinger","fetish","hardcore","nude","erotic","explicit sex","adult video","pornstar","야동","에로","성인","음란","포르노","19금","노골적"],w=`${u.title||u.name||""} ${u.overview||""}`.toLowerCase();if(u.adult||y.some(v=>w.includes(v))){o("해당 콘텐츠는 이용할 수 없습니다."),c(null);return}c(u)}catch(u){console.error("콘텐츠 상세 불러오기 실패:",u),o(u.message||"콘텐츠 정보를 불러오는데 실패했습니다."),d(u.message||"콘텐츠 정보를 불러오는데 실패했습니다.")}finally{k(!1)}})()},[a,i,d]);const L=()=>{p(-1)};return b?e.jsx(z,{}):F&&!g?e.jsx(K,{showDetails:!1,children:e.jsx("div",{className:"error-boundary",children:e.jsxs("div",{className:"error-content",children:[e.jsx("h1",{className:"error-title",children:"콘텐츠를 재생할 수 없습니다"}),e.jsx("p",{className:"error-message",children:F}),e.jsx("div",{className:"error-actions",children:e.jsx("button",{className:"error-btn error-btn-primary",onClick:L,children:"돌아가기"})})]})})}):g?e.jsx(K,{showDetails:!1,children:e.jsx(me,{movie:g,mediaType:i,seasonNumber:l,episodeNumber:m,onClose:L})}):e.jsx(z,{})}export{xe as default};
