import{r as a,j as e,y as ee,C as se,u as te,E as ae,D as re,G as le}from"./index-75deb616.js";import{b as w}from"./tmdb-dd13b212.js";import{M as ne}from"./MovieCard-deef116b.js";import{M as ie}from"./Skeleton-60dc65eb.js";/* empty css               */function ce(o,i=300){const[g,u]=a.useState(o);return a.useEffect(()=>{const v=setTimeout(()=>{u(o)},i);return()=>{clearTimeout(v)}},[o,i]),g}function oe({query:o,onSelect:i,onClose:g}){const[u,v]=a.useState([]),[f,p]=a.useState(!1),d=ce(o,300);return a.useEffect(()=>{if(!d||d.length<2){v([]);return}(async()=>{p(!0);try{const[j,Y]=await Promise.all([w(d,"movie"),w(d,"tv")]),b=(j.results||[]).slice(0,3),E=(Y.results||[]).slice(0,3),k=[...b.map(N=>({...N,media_type:"movie"})),...E.map(N=>({...N,media_type:"tv"}))].slice(0,5);v(k)}catch(j){console.error("ê²€ìƒ‰ ì œì•ˆ ì˜¤ë¥˜:",j),v([])}finally{p(!1)}})()},[d]),!d||d.length<2||u.length===0&&!f?null:e.jsxs("div",{className:"search-suggestions",children:[f&&e.jsx("div",{className:"suggestions-loading",children:"ê²€ìƒ‰ ì¤‘..."}),!f&&u.length>0&&e.jsx("div",{className:"suggestions-list",children:u.map(r=>e.jsxs("div",{className:"suggestion-item",onClick:()=>{i(r),g()},children:[e.jsx("div",{className:"suggestion-poster",children:r.poster_path?e.jsx("img",{src:`https://image.tmdb.org/t/p/w92${r.poster_path}`,alt:r.title||r.name}):e.jsx("div",{className:"suggestion-placeholder",children:"ðŸŽ¬"})}),e.jsxs("div",{className:"suggestion-info",children:[e.jsx("div",{className:"suggestion-title",children:r.title||r.name}),e.jsxs("div",{className:"suggestion-meta",children:[e.jsx("span",{className:"suggestion-type",children:r.media_type==="movie"?"ì˜í™”":"ë“œë¼ë§ˆ"}),r.release_date&&e.jsx("span",{className:"suggestion-year",children:new Date(r.release_date||r.first_air_date).getFullYear()})]})]})]},`${r.media_type}-${r.id}`))})]})}const J="search_history_v1",ue=["ì•¡ì…˜","ë¡œë§¨ìŠ¤","ì½”ë¯¸ë””","ìŠ¤ë¦´ëŸ¬","ê³µí¬","SF","ë“œë¼ë§ˆ","ì• ë‹ˆë©”ì´ì…˜"];function B(){try{const o=localStorage.getItem(J);return o?JSON.parse(o):[]}catch{return[]}}function O(o){try{localStorage.setItem(J,JSON.stringify(o.slice(0,10)))}catch(i){console.error("ê²€ìƒ‰ ížˆìŠ¤í† ë¦¬ ì €ìž¥ ì‹¤íŒ¨:",i)}}function fe(){const{error:o}=ee(),[i,g]=a.useState(""),[u,v]=a.useState("all"),[f,p]=a.useState([]),[d,r]=a.useState([]),[j,Y]=a.useState([]),[b,E]=a.useState([]),[k,N]=a.useState(!1),[V,R]=a.useState(!1),[$,F]=a.useState(B),[h,H]=a.useState(""),[m,T]=a.useState(""),U=se(),C=te(),D=a.useRef(null),L=a.useRef(null),M=a.useCallback(async(s,t=!0)=>{var l,n;if(!s.trim()){p([]),r([]);return}N(!0);try{console.log("ðŸ” ê²€ìƒ‰ ì‹œìž‘:",s);const[S,G]=await Promise.all([w(s,"movie"),w(s,"tv")]);console.log("ðŸ“Š ê²€ìƒ‰ ê²°ê³¼:",{movies:((l=S.results)==null?void 0:l.length)||0,tvs:((n=G.results)==null?void 0:n.length)||0});let y=S.results||[],_=G.results||[];if(Y(y),E(_),t&&(h&&(y=y.filter(x=>{var c;return(c=x.genre_ids)==null?void 0:c.includes(Number(h))}),_=_.filter(x=>{var c;return(c=x.genre_ids)==null?void 0:c.includes(Number(h))})),m)){const x=Number(m);y=y.filter(c=>(c.release_date?new Date(c.release_date).getFullYear():null)===x),_=_.filter(c=>(c.first_air_date?new Date(c.first_air_date).getFullYear():null)===x)}if(p(y),r(_),s.trim()){const x=B(),c=[s.trim(),...x.filter(I=>I!==s.trim())].slice(0,10);F(c),O(c)}}catch(S){console.error("âŒ ê²€ìƒ‰ ì˜¤ë¥˜:",S),p([]),r([]),o("ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.")}finally{N(!1),R(!1)}},[h,m,o]);a.useEffect(()=>{const t=new URLSearchParams(U.search).get("query");t?(g(t),M(t,!0)):(g(""),p([]),r([]))},[U.search,M]),a.useEffect(()=>{if(j.length===0&&b.length===0)return;let s=[...j],t=[...b];if(h&&(s=s.filter(l=>{var n;return(n=l.genre_ids)==null?void 0:n.includes(Number(h))}),t=t.filter(l=>{var n;return(n=l.genre_ids)==null?void 0:n.includes(Number(h))})),m){const l=Number(m);s=s.filter(n=>(n.release_date?new Date(n.release_date).getFullYear():null)===l),t=t.filter(n=>(n.first_air_date?new Date(n.first_air_date).getFullYear():null)===l)}p(s),r(t)},[h,m,j,b]),a.useEffect(()=>{const s=t=>{L.current&&!L.current.contains(t.target)&&D.current&&!D.current.contains(t.target)&&R(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const z=s=>{s.preventDefault();const t=i.trim();t&&C(`/search?query=${encodeURIComponent(t)}`)},K=s=>{C(`/${s.media_type}/${s.id}`)},W=s=>{g(s),C(`/search?query=${encodeURIComponent(s)}`)},X=(s,t)=>{s.stopPropagation();const l=$.filter(n=>n!==t);F(l),O(l)},Z=()=>{F([]),O([])},P=u==="movie"?f:u==="tv"?d:[...f,...d],q=P.length>0,A=i.trim().length>0,Q=Array.from({length:30},(s,t)=>{const l=new Date().getFullYear()-t;return{value:l.toString(),label:l.toString()}});return e.jsx(ae,{showDetails:!1,children:e.jsxs("div",{className:"search-page",children:[e.jsx("div",{className:"search-header",children:e.jsx("form",{onSubmit:z,className:"search-input-wrapper",children:e.jsxs("div",{className:"search-input-container",ref:L,children:[e.jsx("input",{ref:D,type:"text",className:"search-input",placeholder:"ì œëª©, ì‚¬ëžŒ, ìž¥ë¥´ë¡œ ê²€ìƒ‰",value:i,onChange:s=>{g(s.target.value),R(!0)},onFocus:()=>R(!0)}),e.jsx(re,{className:"search-icon"}),V&&e.jsx(oe,{query:i,onSelect:K,onClose:()=>R(!1)})]})})}),A&&q&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"search-tabs",children:[e.jsxs("button",{className:`search-tab ${u==="all"?"active":""}`,onClick:()=>v("all"),children:["ì „ì²´ (",f.length+d.length,")"]}),e.jsxs("button",{className:`search-tab ${u==="movie"?"active":""}`,onClick:()=>v("movie"),children:["ì˜í™” (",f.length,")"]}),e.jsxs("button",{className:`search-tab ${u==="tv"?"active":""}`,onClick:()=>v("tv"),children:["ë“œë¼ë§ˆ (",d.length,")"]})]}),e.jsxs("div",{className:"search-results-header",children:[e.jsxs("div",{className:"search-results-count",children:['"',i,'"ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ ',P.length,"ê°œ"]}),e.jsxs("div",{className:"search-filters",children:[e.jsxs("select",{className:"filter-select",value:h,onChange:s=>H(s.target.value),children:[e.jsx("option",{value:"",children:"ëª¨ë“  ìž¥ë¥´"}),e.jsx("option",{value:"28",children:"ì•¡ì…˜"}),e.jsx("option",{value:"35",children:"ì½”ë¯¸ë””"}),e.jsx("option",{value:"18",children:"ë“œë¼ë§ˆ"}),e.jsx("option",{value:"10749",children:"ë¡œë§¨ìŠ¤"}),e.jsx("option",{value:"27",children:"ê³µí¬"}),e.jsx("option",{value:"878",children:"SF"}),e.jsx("option",{value:"16",children:"ì• ë‹ˆë©”ì´ì…˜"})]}),e.jsxs("select",{className:"filter-select",value:m,onChange:s=>T(s.target.value),children:[e.jsx("option",{value:"",children:"ëª¨ë“  ì—°ë„"}),Q.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),(h||m)&&e.jsx("button",{className:"filter-reset-btn",onClick:()=>{H(""),T("")},title:"í•„í„° ì´ˆê¸°í™”",children:"í•„í„° ì´ˆê¸°í™”"})]})]})]}),k?e.jsx("div",{className:"search-results-grid",children:e.jsx("div",{className:"movie-grid",children:[...Array(12)].map((s,t)=>e.jsx(ie,{},t))})}):A&&q?e.jsx("div",{className:"search-results-grid",children:e.jsx("div",{className:"movie-grid fade-in",children:P.map(s=>e.jsx(ne,{movie:{...s,media_type:s.media_type||u||"movie"}},`${s.media_type||"movie"}-${s.id}`))})}):A&&!q?e.jsxs("div",{className:"search-empty-state",children:[e.jsxs("div",{className:"search-empty-title",children:['"',i,'"ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤']}),e.jsxs("div",{className:"search-empty-text",children:[(h||m)&&e.jsx("div",{style:{marginBottom:"1rem",color:"#00e0ff"},children:"í•„í„°ê°€ ì ìš©ë˜ì–´ ìžˆìŠµë‹ˆë‹¤. í•„í„°ë¥¼ ì´ˆê¸°í™”í•´ë³´ì„¸ìš”."}),"ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¥¼ ì‹œë„í•´ë³´ì„¸ìš”"]}),(h||m)&&e.jsx("button",{className:"popular-tag",onClick:()=>{H(""),T(""),M(i,!1)},style:{marginTop:"1rem"},children:"í•„í„° ì´ˆê¸°í™”í•˜ê³  ë‹¤ì‹œ ê²€ìƒ‰"})]}):e.jsxs("div",{className:"search-empty-state",children:[e.jsx("div",{className:"search-empty-title",children:"ê²€ìƒ‰ì–´ë¥¼ ìž…ë ¥í•´ì£¼ì„¸ìš”"}),e.jsx("div",{className:"search-empty-text",children:"ì˜í™”, ë“œë¼ë§ˆ ì œëª©ì´ë‚˜ ìž¥ë¥´ë¡œ ê²€ìƒ‰í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤"}),$.length>0&&e.jsxs("div",{className:"search-history",children:[e.jsxs("div",{className:"search-history-title",children:["ìµœê·¼ ê²€ìƒ‰ì–´",e.jsx("button",{className:"history-clear-btn",onClick:Z,style:{marginLeft:"1rem",background:"transparent",border:"none",color:"rgba(255,255,255,0.5)",cursor:"pointer",fontSize:"0.85rem"},children:"ì „ì²´ ì‚­ì œ"})]}),e.jsx("div",{className:"history-items",children:$.map((s,t)=>e.jsxs("div",{className:"history-item",onClick:()=>W(s),children:[e.jsx("span",{children:s}),e.jsx("button",{className:"history-remove",onClick:l=>X(l,s),children:e.jsx(le,{})})]},t))})]}),e.jsxs("div",{className:"popular-searches",children:[e.jsx("div",{className:"popular-searches-title",children:"ì¸ê¸° ê²€ìƒ‰ì–´"}),e.jsx("div",{className:"popular-tags",children:ue.map(s=>e.jsx("button",{className:"popular-tag",onClick:()=>{g(s),C(`/search?query=${encodeURIComponent(s)}`)},children:s},s))})]})]})]})})}export{fe as default};
