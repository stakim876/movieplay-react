import{n as _,h as m,a6 as v}from"./index-75deb616.js";let f=null;async function K(){try{if(f)return f;const t=_(m,"adultFilters","default"),e=await v(t);return e.exists()?(f=e.data().bannedKeywords||[],f):[]}catch(t){return console.error("ì„±ì¸ í•„í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:",t),[]}}class b{constructor(e=100,r=5*60*1e3){this.cache=new Map,this.maxSize=e,this.ttl=r}set(e,r){if(this.cache.size>=this.maxSize){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,{value:r,timestamp:Date.now()})}get(e){const r=this.cache.get(e);return r?Date.now()-r.timestamp>this.ttl?(this.cache.delete(e),null):r.value:null}has(e){return this.cache.has(e)&&this.get(e)!==null}clear(){this.cache.clear()}delete(e){this.cache.delete(e)}size(){return this.cache.size}}const c=new b(200,10*60*1e3),w="7824c1cb6d4b09e0b18631b6bfa38a45",g="https://api.themoviedb.org/3";let l=[],d=!0;async function k(){try{d=!0,l=await K(),console.log("ğŸ”¥ Firestore ê¸ˆì¹™ì–´ ë¡œë”©ë¨:",l.length,"ê°œ")}catch(t){console.error("ê¸ˆì¹™ì–´ ë¡œë”© ì‹¤íŒ¨:",t),l=[]}finally{d=!1}}k();const R=[867];function $(t){if(!t||t.adult||["ja","zh"].includes(t.original_language)||t.genre_ids&&t.genre_ids.some(r=>R.includes(r)))return!1;const e=`
    ${t.title||""}
    ${t.name||""}
    ${t.original_title||""}
    ${t.original_name||""}
    ${t.overview||""}
  `.toLowerCase();return!l.some(r=>e.includes(r.toLowerCase()))}async function T(t){try{const e=t.replace(/(\?|&)include_adult=true/g,""),r=`${g}${e}${e.includes("?")?"&":"?"}api_key=${w}&language=ko-KR&include_adult=false`,s=`movies_${e}`,o=c.get(s);if(o)return o;const n=await fetch(r);if(!n.ok)throw new Error(`TMDb API í˜¸ì¶œ ì‹¤íŒ¨: ${n.status}`);const a=await n.json();return a.results=(a.results||[]).filter($),c.set(s,a),a}catch(e){return console.error("fetchMovies error:",e),{results:[]}}}async function x(t,e="movie"){try{const r=`detail_${e}_${t}`,s=c.get(r);if(s)return s;const n=await fetch(`${g}/${e}/${t}?api_key=${w}&language=ko-KR&append_to_response=${e==="tv"?"videos,credits,recommendations,similar":"videos"}`);if(!n.ok)throw new Error("ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const a=await n.json();if(!$(a))throw new Error("ì„±ì¸ ì½˜í…ì¸  ì°¨ë‹¨ë¨");return c.set(r,a),a}catch(r){throw console.error("fetchMovieDetail error:",r),r}}async function C(t,e){try{const r=`season_${t}_${e}`,s=c.get(r);if(s)return s;const o=await fetch(`${g}/tv/${t}/season/${e}?api_key=${w}&language=ko-KR`);if(!o.ok)throw new Error("ì‹œì¦Œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const n=await o.json();return c.set(r,n),n}catch(r){throw console.error("fetchTVSeason error:",r),r}}async function z(t,e="movie"){var r;try{if(d&&(console.warn("â³ ê¸ˆì¹™ì–´ ë¡œë”© ì¤‘ â†’ ê²€ìƒ‰ ì°¨ë‹¨"),await new Promise(h=>setTimeout(h,500)),d))return{results:[]};const s=t.toLowerCase().trim();if(l.length>0&&l.some(h=>s.includes(h.toLowerCase())))return console.warn("ğŸš« ê¸ˆì¹™ì–´ ê²€ìƒ‰ ì°¨ë‹¨ë¨:",t),{results:[]};const o=encodeURIComponent(t.trim());if(!o)return{results:[]};const n=`search_${e}_${o}`,a=c.get(n);if(a)return a;const y=`${g}/search/${e}?api_key=${w}&language=ko-KR&query=${o}&include_adult=false`,u=await fetch(y);if(!u.ok)throw console.error(`âŒ TMDB API ì˜¤ë¥˜: ${u.status}`,await u.text()),new Error(`TMDb ê²€ìƒ‰ ì‹¤íŒ¨: ${u.status}`);const i=await u.json(),S=((r=i.results)==null?void 0:r.length)||0,p=(i.results||[]).filter(h=>$(h));i.results=p;const M=i.results.length;return c.set(n,i),i}catch(s){return console.error("âŒ fetchSearchResults error:",s),{results:[]}}}export{x as a,z as b,C as c,T as f};
